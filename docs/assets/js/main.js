"use strict";function toLowerCase(e){e.toLowerCase()}const listEl=document.querySelector(".js-list-char"),favListEl=document.querySelector(".js-list-fav-char"),searchInputEl=document.querySelector(".js-search-input"),searchBtnEl=document.querySelector(".js-search-btn");let charactersList=[],allCharacters=[],favCharacters=[],favCharactersObjList=[],delIcons=[],filteredCharList=[];const delBtnEl=document.querySelector(".js-del-btn");function renderChar(e){const t=document.createElement("li");t.setAttribute("class","char__list--item js-char-item"),t.setAttribute("id",e.char_id);const a=document.createElement("article");a.setAttribute("class","char__article");const s=document.createElement("img");s.setAttribute("class","char__article--img"),s.setAttribute("src",e.img),s.setAttribute("alt",e.name),a.appendChild(s);const r=document.createElement("h3");r.setAttribute("class","char__article--title");const c=document.createTextNode(e.name);r.appendChild(c),a.appendChild(r);const n=document.createElement("small");n.setAttribute("class","char__article--subtitle");const l=document.createTextNode(e.status);return n.appendChild(l),a.appendChild(n),t.appendChild(a),t}function renderAllChar(e){for(const t of e){const e=renderChar(t);listEl.appendChild(e)}}function renderFavChar(e){const t=document.createElement("li");t.setAttribute("class","char__list--item js-favchar-item"),t.setAttribute("id",e.char_id);const a=document.createElement("article");a.setAttribute("class","char__article");const s=document.createElement("i");s.setAttribute("class","fa-solid fa-xmark char__article--del js-fav-del"),s.setAttribute("id",e.char_id),a.appendChild(s);const r=document.createElement("img");r.setAttribute("class","char__article--img"),r.setAttribute("src",e.img),r.setAttribute("alt",e.name),a.appendChild(r);const c=document.createElement("h3");c.setAttribute("class","char__article--title");const n=document.createTextNode(e.name);c.appendChild(n),a.appendChild(c);const l=document.createElement("small");l.setAttribute("class","char__article--subtitle");const i=document.createTextNode(e.status);return l.appendChild(i),a.appendChild(l),t.appendChild(a),t}function renderAllFavChar(e){for(const t of e){const e=renderFavChar(t);favListEl.appendChild(e)}}function checkFav(e){const t=charactersList.find(t=>t.char_id===parseInt(e.id)),a=favCharactersObjList.findIndex(t=>t.char_id===parseInt(e.id));-1===a?favCharactersObjList.push(t):(favCharactersObjList.splice(a,1),e.classList.remove("js-selected"))}function fillFavSection(e){favListEl.innerHTML="",renderAllFavChar(e)}function saveFavLs(){localStorage.setItem("fs",JSON.stringify(favCharactersObjList))}function createFavArr(){favCharacters=document.querySelectorAll(".js-favchar-item")}function addFavClass(){for(const e of favCharacters)e.classList.add("js-highlight")}function addDeleteListeners(){delIcons=document.querySelectorAll(".js-fav-del");for(const e of delIcons)e.addEventListener("click",handleDelClick)}function addGenDelBtn(){0!==favCharacters.length?delBtnEl.classList.remove("js-hidden"):delBtnEl.classList.add("js-hidden")}function handleListClick(e){const t=e.currentTarget;t.classList.toggle("js-selected"),checkFav(t),fillFavSection(favCharactersObjList),saveFavLs(),createFavArr(),addFavClass(),addGenDelBtn(),addDeleteListeners()}fetch("https://breakingbadapi.com/api/characters",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{charactersList=e,renderAllChar(charactersList),allCharacters=document.querySelectorAll(".js-char-item");for(const e of allCharacters)e.addEventListener("click",handleListClick);for(const e of allCharacters)if(null!==favCharacters)for(const t of favCharacters)parseInt(t.id)===parseInt(e.id)&&e.classList.add("js-selected")});const savedFavChar=JSON.parse(localStorage.getItem("fs"));function handleSearchBtn(e){e.preventDefault();const t=searchInputEl.value.toLowerCase();if(0===charactersList.length)listEl.innerHTML="Please wait a few seconds until the information has been loaded";else if(""===t)alert("You must write the name of a character");else{const e=charactersList.filter(e=>e.name.toLowerCase().includes(t));if(0!==e.length){listEl.innerHTML="",renderAllChar(e),filteredCharList=document.querySelectorAll(".js-char-item");for(const e of filteredCharList)if(null!==favCharacters)for(const t of favCharacters)parseInt(t.id)===parseInt(e.id)&&e.classList.add("js-selected");for(const e of filteredCharList)e.addEventListener("click",handleListClick)}else listEl.innerHTML="Sorry, no results were found for your search"}}function handleSearchInput(e){""===e.currentTarget.value&&(listEl.innerHTML="",renderAllChar(charactersList))}function handleDelClick(e){const t=e.currentTarget;for(const e of allCharacters)parseInt(e.id)===parseInt(t.id)&&e.classList.remove("js-selected");for(const e of filteredCharList)parseInt(e.id)===parseInt(t.id)&&e.classList.remove("js-selected");const a=favCharactersObjList.findIndex(e=>e.char_id===parseInt(t.id));favCharactersObjList.splice(a,1),favListEl.innerHTML="",renderAllFavChar(favCharactersObjList),saveFavLs(),delIcons=document.querySelectorAll(".js-fav-del"),0===delIcons.length&&delBtnEl.classList.add("js-hidden");for(const e of delIcons)e.addEventListener("click",handleDelClick)}function handleDelBtnClick(){0!==favCharacters.length&&(favListEl.innerHTML="",favCharactersObjList=[],saveFavLs());for(const e of allCharacters)e.classList.remove("js-selected");for(const e of filteredCharList)e.classList.remove("js-selected");delBtnEl.classList.add("js-hidden")}null!==savedFavChar&&(favCharactersObjList=savedFavChar,renderAllFavChar(savedFavChar),createFavArr(),addFavClass(),addDeleteListeners(),0!==favCharacters.length?delBtnEl.classList.remove("js-hidden"):delBtnEl.classList.add("js-hidden")),searchBtnEl.addEventListener("click",handleSearchBtn),searchInputEl.addEventListener("input",handleSearchInput),delBtnEl.addEventListener("click",handleDelBtnClick);